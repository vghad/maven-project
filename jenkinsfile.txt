pipeline{
	agent any

	tools{
		maven 'localmaven'
	}

	parameters{
		 string(name:'tomcatwebapp_port', defaultValue:'7070', description:'Tomcat WebApp Port')
	}
        stages{		
			stage('Build'){
					steps{
						sh 'mvn clean package'
						sh "docker build -t tomcatwebapp:${env.BUILD_ID} -f ./Dockerfile.txt ."
					}
	        }
			stage('Delete old docker container'){
					steps{
						 def foo =  "docker ps -aq -f name=tomcatwebapp"
						 if ( $foo == NULL)
						 {
							echo 'No old docker container found'
						 }						 
						 else {							
							echo 'Deleting Old Docker container...'
							sh "docker rm -f \$(docker ps -aq -f name=tomcatwebapp)"
							echo 'Old Docker container Deleted successfully'
						 }
			     }
			 }
			 
			 stage('Start docker container' ){
				    echo 'Starting Docker Container'
					sh "docker run --name tomcatwebapp -d -p ${params.tomcatwebapp_port}:8080 tomcy at port : ${params.tomcatwebapp_port}"
					echo "Docker Container started successfully at port : ${params.tomcatwebapp_port}"
			 }
			 stage('Docker image push') {
			        echo "Docker image push on a docker hub...."
                    sh "docker push frenley/development_env:tomcatwebapp" 
					echo "Docker image successfully push on docker hub.....!!!"
			 
			 }
	}
}	
